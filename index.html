<!DOCTYPE html>
<html>
<head>
    <title>Verlanglijst</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #000fb3;
            --hover-color: #3700b3;
            --background-color: #f4f4f9;
            --card-background: white;
            --text-color: #333;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --gray-100: #f7f7f7;
            --gray-200: #e6e6e6;
            --gray-300: #d4d4d4;
            --transition-speed: 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--hover-color));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .wishlist-item {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all var(--transition-speed) ease;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .wishlist-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .item-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid var(--gray-200);
            transition: transform var(--transition-speed) ease;
        }

        .wishlist-item:hover .item-image {
            transform: scale(1.05);
        }

        .item-content {
            padding: 1.5rem;
        }

        .item-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0 0 1rem 0;
            color: var(--text-color);
        }

        .item-link {
            display: inline-flex;
            align-items: center;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 1rem;
            transition: color var(--transition-speed) ease;
        }

        .item-link:hover {
            color: var(--hover-color);
        }

        .item-link::after {
            content: '‚Üó';
            margin-left: 4px;
            font-size: 1.1em;
        }

        .item-status {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .bought {
            opacity: 0.7;
            transform: scale(0.98);
        }

        .bought .item-title {
            text-decoration: line-through;
            color: #999;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background-color: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .success { 
            background-color: var(--success-color);
            animation: pulse 1s ease-out;
        }

        .error { 
            background-color: var(--error-color);
            animation: pulse 1s ease-out;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            backdrop-filter: blur(4px);
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .modal {
            display: block;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 90%;
            width: 500px;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .modal h2 {
            margin: 0 0 1rem;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .modal-content {
            margin: 1rem 0;
            line-height: 1.6;
        }

        .modal ol {
            padding-left: 1.5rem;
        }

        .modal li {
            margin: 0.5rem 0;
        }

        .modal button {
            margin-top: 1.5rem;
        }

        .loading {
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.2),
                transparent
            );
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2rem;
            }

            .modal {
                width: 85%;
                padding: 1.5rem;
            }
        }

        .intro-text {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        .name-input {
            width: 100%;
            padding: 0.75rem;
            margin: 1rem 0;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color var(--transition-speed) ease;
        }

        .name-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .undo-button {
            background-color: var(--error-color);
            margin-top: 0.5rem;
        }

        .undo-button:hover {
            background-color: #d32f2f;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .contact-info {
            background-color: #f0f6fc;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #dbe7f7;
        }

        .claimed-by {
            font-style: italic;
            color: var(--success-color);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .button-group button {
            margin: 0;
        }

        .unclaim-button {
            background-color: var(--error-color);
        }

        .unclaim-button:hover {
            background-color: #d32f2f;
        }

        #contactEmail {
            font-weight: bold;
            color: var(--primary-color);
        }

        .auth-button {
            background-color: #2da44e;
            display: inline-block;
            width: auto;
            margin: 1rem 0;
        }

        .github-login {
            text-align: center;
            margin: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>Bram's Verlanglijst</h1>
    </header>
    
    <div class="intro-text">
        <h2>Welkom bij mijn verlanglijst! üéÅ</h2>
        <p>Hoewel ik weet dat jaarlijks de vraag eraan komt "wat wil je hebben/heb je nog wensen?", ben ik hier normaal nooit op voorbereid. Omdat het nu toch eens een keer handig wordt om iets te regelen voor mijn 30e verjaardag heb ik heb een aantal suggesties verzameld waar ik erg blij mee zou zijn.</p>
        
        <div class="info-section" style="margin-top: 1.5rem; padding: 1.5rem; background: #f8f9fa; border-radius: 12px; border: 1px solid #e9ecef;">
            <h3 style="color: var(--primary-color); margin-top: 0;">üìù Hoe werkt het?</h3>
            <p>1. Bekijk de items in de lijst hieronder<br>
               2. Vind je iets leuks? Klik op "Ik wil dit kopen" en vul je naam in<br>
               3. Het item wordt dan direct voor jou gereserveerd<br>
               4. Heb je je bedacht? Je kunt je reservering altijd weer annuleren</p>
        </div>
    </div>

    <div class="no-gifts" style="max-width: 800px; margin: 2rem auto; padding: 1.5rem; background: #ffebee; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; border: 1px solid #ffcdd2;">
        <h3 style="color: #c62828; margin-top: 0;">‚ùå Liever niet:</h3>
        <p>Ik waardeer het aanbod, maar ik drink geen alcohol meer. Dus liever geen wijn, bier of andere alcoholische dranken.</p>
    </div>

    <div id="status-container"></div>
    <div class="container" id="wishlist"></div>

    <script>
        let wishlistItems = [];
        
        async function fetchWishlist() {
            try {
                console.log('Fetching wishlist...');
                // Get the base URL for GitHub Pages
                const basePath = window.location.pathname.endsWith('/') 
                    ? window.location.pathname 
                    : window.location.pathname + '/';
                const response = await fetch(basePath + 'wishlist.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                try {
                    wishlistItems = JSON.parse(text);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    console.log('Problematic JSON text:', text);
                    throw new Error(`JSON parsing failed: ${parseError.message}`);
                }

                if (!Array.isArray(wishlistItems)) {
                    throw new Error('Wishlist data is not an array');
                }

                console.log('Wishlist loaded:', wishlistItems);
                renderWishlist();
            } catch (error) {
                console.error('Error:', error);
                showStatus(`Er is een fout opgetreden: ${error.message}`, 'error');
            }
        }

        async function updateWishlist(itemIndex, reservedBy) {
            try {
                wishlistItems[itemIndex].reserved = reservedBy ? { name: reservedBy } : null;
                renderWishlist();
                showStatus(reservedBy ? 'Item gereserveerd!' : 'Reservering verwijderd!', 'success');
                
                // Save to localStorage as temporary storage
                localStorage.setItem('wishlistReservations', JSON.stringify(wishlistItems));
            } catch (error) {
                console.error('Error:', error);
                showStatus('Er is een fout opgetreden bij het bijwerken van de reservering', 'error');
            }
        }

        function loadStoredReservations() {
            const stored = localStorage.getItem('wishlistReservations');
            if (stored) {
                try {
                    wishlistItems = JSON.parse(stored);
                    renderWishlist();
                } catch (e) {
                    console.error('Error loading stored reservations:', e);
                }
            }
        }

        async function claimItem(index) {
            const name = prompt('Wat is je naam?');
            if (name) {
                await updateWishlist(index, name);
            }
        }

        async function unclaimItem(index) {
            const item = wishlistItems[index];
            if (confirm(`Weet je zeker dat je de reservering voor "${item.name}" wilt verwijderen?`)) {
                await updateWishlist(index, null);
            }
        }

        function renderWishlist() {
            const list = document.getElementById('wishlist');
            if (!Array.isArray(wishlistItems)) {
                console.error('Wishlist is not an array:', wishlistItems);
                showStatus('Er is een fout opgetreden bij het laden van de lijst', 'error');
                return;
            }
            
            list.innerHTML = wishlistItems.map((item, index) => `
                <div class="wishlist-item ${item.reserved ? 'bought' : ''}">
                    <img src="${item.image}" alt="${item.name}" class="item-image" onerror="this.src='images/placeholder.svg'">
                    <div class="item-content">
                        <h2 class="item-title">${item.name}</h2>
                        ${item.url ? `<a href="${item.url}" target="_blank" class="item-link">Bekijk product</a>` : ''}
                        <div class="item-status">
                            ${item.reserved 
                                ? `
                                    <span class="claimed-by">Gekocht door: ${item.reserved.name}</span>
                                    <button class="unclaim-button" onclick="unclaimItem(${index})">Annuleer reservering</button>
                                `
                                : `<button onclick="claimItem(${index})">Ik wil dit kopen</button>`
                            }
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${type}`;
            statusDiv.textContent = message;
            container.appendChild(statusDiv);
            
            // Remove the message after 3 seconds
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }

        // Load wishlist when page loads
        window.onload = async () => {
            await fetchWishlist();
            loadStoredReservations();
        };
    </script>
</body>
</html>
